---
title: "Micro/macro chromosome correlates analyses"
author: "Natalie Cooper"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Preparation

```{r, message = FALSE, echo = FALSE}
# Load libraries
library(tidyverse)
library(here)
library(ape)
library(broom)
library(patchwork)
library(ggfortify)
```

Read in the data and the tree
```{r, message = FALSE, echo = FALSE}
mydata <- read_csv(here("data/chromosome-data.csv"))
mytree <- read.tree(here("data/ML-tree.tre"))
```

Take a look at the dataset and tree
```{r}
#str(mytree)
#head(mydata)
```


## Micro versus macro chromosomes models 
```{r}
# n versus macro
m1 <- glm(haploidn ~ macrop, data = mydata, family = "poisson")
# Model diagnostics
# autoplot(m1)
# Check for overdispersion
# summary(m1)$deviance / summary(m1)$df.resid 
tidy(anova(m1, test = "Chisq"))

# Create predict line for graphs
newX1 <- data.frame(macrop = seq(min(mydata$macrop), 
                                max(mydata$macrop), length = 50))
newY1 <- predict.glm(m1, newdata = newX1, type = "response", se.fit = TRUE)
add1 <- data.frame(newX1, newY1)
add1 <- add1 %>% rename(haploidn = fit)
```

```{r}
# n versus micro
m2 <- glm(haploidn ~ microp, data = mydata, family = "poisson")
# Model diagnostics
# autoplot(m2)
# Check for overdispersion
# summary(m2)$deviance / summary(m2)$df.resid 
tidy(anova(m2, test = "Chisq"))

# Create predict line for graphs
newX2 <- data.frame(microp = seq(min(mydata$microp), 
                                max(mydata$microp), length = 50))
newY2 <- predict.glm(m2, newdata = newX2, type = "response", se.fit = TRUE)
add2 <- data.frame(newX2, newY2)
add2 <- add2 %>% rename(haploidn = fit)
```


```{r}
# macro versus micro
m3 <- glm(microp ~ macrop, data = mydata, family = "poisson")
# Model diagnostics
# autoplot(m3)
# Check for overdispersion
# summary(m3)$deviance / summary(m3)$df.resid 
tidy(anova(m3, test = "Chisq"))

# Create predict line for graphs
# same X as in m1
newY3 <- predict.glm(m3, newdata = newX1, type = "response", se.fit = TRUE)
add3 <- data.frame(newX1, newY3)
add3 <- add3 %>% rename(microp = fit)
```


## Micro versus macro chromosomes plots

```{r}
mac <- 
  ggplot(mydata, aes(x = macrop, y = haploidn)) +
  geom_point() +
  theme_bw() +
  xlab("macro pairs") +
  ylab("chromosomes (n)") +
  geom_line(data = add1, colour = "black") +
  geom_ribbon(data = add1, 
              aes(ymin = haploidn + se.fit, ymax = haploidn - se.fit), 
              alpha = 0.5, fill = "grey50")

mic <- 
  ggplot(mydata, aes(x = microp, y = haploidn)) +
  geom_point() +
  theme_bw() +
  xlab("micro pairs") +
  ylab("chromosomes (n)") +
  geom_line(data = add2, colour = "black") +
  geom_ribbon(data = add2, 
              aes(ymin = haploidn + se.fit, ymax = haploidn - se.fit), 
              alpha = 0.5, fill = "grey50")

both <- 
  ggplot(mydata, aes(x = macrop, y = microp)) +
  geom_point() +
  theme_bw() +
  xlab("macro pairs") +
  ylab("micro pairs") +
  geom_line(data = add3, colour = "black") +
  geom_ribbon(data = add3, 
              aes(ymin = microp + se.fit, ymax = microp - se.fit), 
              alpha = 0.5, fill = "grey50")
 
# Plot
mac + mic + both

# Save plot
# ggsave(filename = here("outputs/micro-macro-chromosomes.png"), height = 4)
```